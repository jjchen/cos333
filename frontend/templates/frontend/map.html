<html>
    
    <head>
        <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>{% load staticfiles %}
        <link rel="stylesheet" type="text/css" href="{% static "frontend/style.css" %}" />
        <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDbkTcw7IQzJtELnuovVYEMDQg-zex6oG0&sensor=true">
            
        </script>
        <script type="text/javascript">
            var map;
            var geocoder;

            function initialize() {
                var center = new google.maps.LatLng(40.344725, -74.655629);
                geocoder = new google.maps.Geocoder();

                //makeList();

                var mapOptions = {
                    center: center,
                    zoom: 17,
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                };
                map = new google.maps.Map(document.getElementById("map-canvas"),
                    mapOptions);

                {% if events_list %}
                  showEventsOnMap();
                {% endif %}
            }
            google.maps.event.addDomListener(window, 'load', initialize);


            function codeAddress() {
                var image = '{% static "frontend/paw_print.png" %}';

                var buildingName = document.getElementById("search").value;
                geocoder.geocode({
                    'address': buildingName
                }, function (results, status) {
                    if (status == google.maps.GeocoderStatus.OK) {
                        // map.setCenter(results[0].geometry.location);
                        var marker = new google.maps.Marker({
                            map: map,
                            position: results[0].geometry.location,
                            icon: image
                        });

                        var contentString = '<div id="content">' +
                            '<div id="siteNotice">' +
                            '</div>' +
                            '<h2 id="firstHeading" class="firstHeading">{{map_event_name}}</h2>' +
                            '<div id="bodyContent">' +
                            '<p>Time: 10:00pm April 2, 2013</p>' +
                            '<p>Location: {{map_event_location}}</p>' +
                            '</div>' +
                            '</div>';

                        var infowindow = new google.maps.InfoWindow({
                            content: contentString
                        });

                        google.maps.event.addListener(marker, 'click', function () {
                            infowindow.open(map, marker);
                        });

                    } else {
                        alert("Geocode was not successful for the following reason: " + status);
                    }
                });
            }

            function showEventsOnMap() {

                var image = '{% static "frontend/paw_print.png" %}';
                var i = 0;
                {% for event in events_list %}
                {% if event.lat %}
                  eval("var position"+i+" = new google.maps.LatLng( {{event.lat}}, {{event.lon}})");

                  eval("var marker"+i+" = new google.maps.Marker({ \
                      map: map, \
                      position: position"+i+", \
                      icon: image \
                  })");

                  eval("var contentString"+i+" = '<div class=\"infoWindow_content\">' + \
                      '<h3 class=\"infoWindow_heading\">{{event.name}}</h3>' + \
                      '<div id=\"infoWindow_body\">' + \
                      '<p>Time: 10:00pm April 2, 2013</p>' + \
                      '<p>Location: {{event.location}}</p>' + \
                      '</div>' + \
                      '</div>'");

                  eval("var infowindow"+i+" = new google.maps.InfoWindow({ \
                      content: contentString"+i+" \
                  })");

                  eval("google.maps.event.addListener(marker"+i+", 'click', function () { \
                      infowindow"+i+".open(map, marker"+i+"); \
                  })");
                  i++;
                {% endif %}
                {% endfor %}
            }


            function showContent(id) {
                //alert(id);
                var elem = document.getElementById('content_wrapper');
                for (i = 0; i < elem.children.length; i++) {
                    if (elem.children[i].id != id) {
                        elem.children[i].className = 'hidden';
                    } else {
                        elem.children[i].className = (elem.children[i].className == 'hidden') ? 'visible' : 'hidden';
                    }
                }
            }

        </script>
    </head>
    
    <body>
        <header>
              <h1>Princeton University - OC</h1>

        </header>
        <div id="side_panel">
              <h3>Filter</h3>

            <input id="search" type="textbox" placeholder="Search" onkeydown="if (event.keyCode == 13) document.getElementById('search_button').click()">
            <input id='search_button' type="button" value="Go" onclick="codeAddress()">
            <br/>
            <form action="{% url 'frontend:search' %}" method="post">{% csrf_token %}
                <input type="text" id="search_query" placeholder="Search" name="search_query" required>
                <input type="submit" value="Go">
            </form>
            <br/>{{user}}
            <div id="time_slider">
                 <h3> Time </h3>

                <input type="range">
            </div>
        </div>
        <div id="content_wrapper">
            <div id="list_content" class="hidden">
                  <h3> List </h3>

                <div id="list_inner_wrapper">{% if events_list %}
                    <ul>{% for event in events_list %}
                        <li>{{event.name}} {{event.location}} {{event.time}} {{event.date}}</li>{% endfor %}</ul>{% else %}
                    <p>No events :(</p>{% endif %}</div>
            </div>
            <div id="make_content" class="hidden">
                  <h3> Make Event </h3>

                <form action="{% url 'frontend:add' %}" method="post">{% csrf_token %}
                    <label>Name:</label>
                    <input type="text" id="event_name" name="event_name" required>
                    <label>Date:</label>
                    <input type="date" id="date" name="date" required>
                    <label>Time:</label>
                    <input type="time" id="start_time" name="start_time">
                    <label>Location:</label>
                    <input type="text" id="location" name="location">
                    <input type="submit" value="Submit">
                </form>
            </div>
            <div id="calendar_content" class="hidden">
                  <h3> Calendar</h3>

                <li><a rel="nofollow" href="{% url 'socialauth_begin' 'facebook' %}">Facebook</a>
                </li>
            </div>
        </div>
        <div id="make_button" class="button" onclick="showContent('make_content');">
              <h3>Make</h3>

        </div>
        <div id="calendar_button" class="button" onclick="showContent('calendar_content');">
              <h3>Calendar</h3>

        </div>
        <div id="list_button" class="button" onclick="showContent('list_content');">
              <h3>List</h3>

        </div>
        <div id="minus_button" class="button" onclick="showContent('none');">
              <h3>-</h3>

        </div>
        <div id="map-canvas" />
    </body>

</html>